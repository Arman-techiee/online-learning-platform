{% extends "base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4">Welcome, {{ current_user.username }}!</h1>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <i class="fas fa-book fa-3x text-primary mb-3"></i>
                    <h3>{{ enrolled_courses|length }}</h3>
                    <p class="text-muted">Enrolled Courses</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <i class="fas fa-tasks fa-3x text-success mb-3"></i>
                    <h3>{{ enrollments|selectattr('completed')|list|length }}</h3>
                    <p class="text-muted">Completed</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                    <h3>{{ (enrollments|selectattr('progress')|map(attribute='progress')|sum / (enrollments|length if
                        enrollments|length > 0 else 1))|round|int }}%</h3>
                    <p class="text-muted">Avg Progress</p>
                </div>
            </div>
        </div>
    </div>

    <h3 class="mb-3">My Courses</h3>
    <div class="row">
        {% if enrolled_courses %}
        {% for course in enrolled_courses %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <img src="{{ url_for('static', filename='uploads/courses/' + course.image) }}" class="card-img-top"
                    alt="{{ course.title }}"
                    onerror="this.src='{{ url_for('static', filename='images/default_course.jpg') }}'">
                <div class="card-body">
                    <h5 class="card-title">{{ course.title }}</h5>
                    <p class="card-text text-muted">{{ course.description[:80] }}...</p>

                    {% set enrollment = enrollments|selectattr('course_id', 'equalto', course.id)|first %}
                    <div class="progress mb-2">
                        <div class="progress-bar" role="progressbar" style="width: {{ enrollment.progress }}%"
                            aria-valuenow="{{ enrollment.progress }}" aria-valuemin="0" aria-valuemax="100">
                            {{ enrollment.progress }}%
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <a href="{{ url_for('courses.detail', course_id=course.id) }}"
                        class="btn btn-primary w-100">Continue Learning</a>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-book-open fa-4x text-muted mb-3"></i>
            <h3>No Courses Yet</h3>
            <p class="text-muted">Start your learning journey by enrolling in a course</p>
            <a href="{{ url_for('courses.browse') }}" class="btn btn-primary">Browse Courses</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}